'use strict';

var chalk     = require('chalk');
var Command   = require('../models/command');
var Promise   = require('../ext/promise');
var merge     = require('lodash-node/modern/objects/merge');

module.exports = Command.extend({
  name: 'destroy',
  description: 'Destroys code generated by `generate` command.',
  aliases: ['d'],
  works: 'insideProject',

  availableOptions: [
    { name: 'dry-run', type: Boolean, default: false },
    { name: 'verbose', type: Boolean, default: false }
  ],

  anonymousOptions: [
    '<blueprint>'
  ],

  run: function(commandOptions, rawArgs) {
    var ui            = this.ui;
    var blueprintName = rawArgs[0];
    var entityName    = rawArgs[1];

    if (!blueprintName) {
      ui.write(chalk.yellow('The `ember destroy` command requires a ' +
                            'blueprint name to be specified. ' +
                            'For more details, use `ember help`.\n'));

      return Promise.reject();
    }

    if (!entityName) {
      ui.write(chalk.yellow('The `ember destroy` command requires an ' +
                            'entity name to be specified. ' +
                            'For more details, use `ember help`.\n'));

      return Promise.reject();
    }

    var Task = this.tasks.DestroyFromBlueprint;
    var task = new Task({
      ui: this.ui,
      analytics: this.analytics,
      project: this.project
    });

    var taskArgs = {
      args: rawArgs
    };

    var taskOptions = merge(taskArgs, commandOptions || {});

    if (this.project.initializeAddons) {
      this.project.initializeAddons();
    }

    return task.run(taskOptions);
  },

  printDetailedHelp: function() {
    var ui = this.ui;

    ui.write('\n  Run `ember help generate` to view a list of available blueprints. \n');
  }
});
